<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ë–∏–ª—å—è—Ä–¥ –∏ –∏–Ω–µ—Ä—Ü–∏—è</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: #1a1a2e;
      color: #f1f1f1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-bottom: 10px;
      color: #16c79a;
    }

    #controls {
      margin: 10px 0;
      text-align: center;
    }

    button {
      padding: 8px 16px;
      background: #3a86ff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 0 5px;
    }

    button:hover {
      background: #2a6bd9;
    }

    canvas {
      background: #0a5f20;
      border: 6px solid #5d4037;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.7);
      margin-bottom: 20px;
    }

    #info {
      max-width: 620px;
      background: #16213e;
      padding: 16px;
      border-radius: 10px;
      border-left: 4px solid #16c79a;
      font-size: 14px;
      line-height: 1.5;
    }

    .formula {
      background: #0d1b2a;
      padding: 8px;
      border-radius: 6px;
      font-family: monospace;
      margin: 8px 0;
      display: inline-block;
    }
  </style>
</head>
<body>

<h1>üé± –ë–∏–ª—å—è—Ä–¥: –∏–Ω–µ—Ä—Ü–∏—è –≤ –¥–µ–π—Å—Ç–≤–∏–∏</h1>
<div id="controls">
  <button onclick="resetGame()">–°–±—Ä–æ—Å–∏—Ç—å</button>
  <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –±–µ–ª—ã–π —à–∞—Ä ‚Üí –ø–æ—Ç—è–Ω–∏—Ç–µ ‚Üí –æ—Ç–ø—É—Å—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —É–¥–∞—Ä–∏—Ç—å!</p>
</div>

<canvas id="table"></canvas>

<div id="info">
  <h3>–ß—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω–µ—Ä—Ü–∏—è?</h3>
  <p>
    <strong>–ò–Ω–µ—Ä—Ü–∏—è</strong> ‚Äî —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ —Ç–µ–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫–æ—è –∏–ª–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–∞ –Ω–µ–≥–æ –Ω–µ –ø–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç –≤–Ω–µ—à–Ω—è—è —Å–∏–ª–∞.
  </p>
  <p>
    –ò–Ω–µ—Ä—Ü–∏—è –Ω–∞–ø—Ä—è–º—É—é —Å–≤—è–∑–∞–Ω–∞ —Å <strong>–º–∞—Å—Å–æ–π</strong>: —á–µ–º –±–æ–ª—å—à–µ –º–∞—Å—Å–∞ —Ç–µ–ª–∞, —Ç–µ–º –±–æ–ª—å—à–µ –µ–≥–æ –∏–Ω–µ—Ä—Ü–∏—è.
  </p>
  
  <h4>–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã:</h4>
  <p>
    <span class="formula">F = m ¬∑ a</span> ‚Äî –í—Ç–æ—Ä–æ–π –∑–∞–∫–æ–Ω –ù—å—é—Ç–æ–Ω–∞. –°–∏–ª–∞ = –º–∞—Å—Å–∞ √ó —É—Å–∫–æ—Ä–µ–Ω–∏–µ.
  </p>
  <p>
    <span class="formula">p = m ¬∑ v</span> ‚Äî –ò–º–ø—É–ª—å—Å —Ç–µ–ª–∞. –ò–º–ø—É–ª—å—Å = –º–∞—Å—Å–∞ √ó —Å–∫–æ—Ä–æ—Å—Ç—å.
  </p>
  <p>
    –ü—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏ (–∫–∞–∫ –≤ –±–∏–ª—å—è—Ä–¥–µ) <strong>–∏–º–ø—É–ª—å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è</strong>:
    <span class="formula">m‚ÇÅv‚ÇÅ + m‚ÇÇv‚ÇÇ = m‚ÇÅv‚ÇÅ' + m‚ÇÇv‚ÇÇ'</span>
  </p>
  <p>
    –í –Ω–∞—à–µ–π –∏–≥—Ä–µ –≤—Å–µ —à–∞—Ä—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –º–∞—Å—Å—É, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –ª–æ–±–æ–≤–æ–º —É–¥–∞—Ä–µ –ø–æ–∫–æ—è—â–∏–π—Å—è —à–∞—Ä "–∑–∞–±–∏—Ä–∞–µ—Ç" –≤—Å—é —Å–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂—É—â–µ–≥–æ—Å—è ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ <strong>–∏–Ω–µ—Ä—Ü–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º–ø—É–ª—å—Å–∞</strong>.
  </p>
</div>

<script>
  const canvas = document.getElementById('table');
  const ctx = canvas.getContext('2d');

  // –†–∞–∑–º–µ—Ä—ã —Å—Ç–æ–ª–∞
  const tableWidth = 600;
  const tableHeight = 300;
  const ballRadius = 12;
  const friction = 0.985; // —Ç—Ä–µ–Ω–∏–µ

  canvas.width = tableWidth;
  canvas.height = tableHeight;

  // –õ—É–∑—ã (6 —à—Ç—É–∫)
  const pockets = [
    { x: 0, y: 0, r: 20 }, // –≤–µ—Ä—Ö-–ª–µ–≤–æ
    { x: tableWidth, y: 0, r: 20 }, // –≤–µ—Ä—Ö-–ø—Ä–∞–≤–æ
    { x: 0, y: tableHeight, r: 20 }, // –Ω–∏–∑-–ª–µ–≤–æ
    { x: tableWidth, y: tableHeight, r: 20 }, // –Ω–∏–∑-–ø—Ä–∞–≤–æ
    { x: tableWidth / 2, y: 0, r: 20 }, // –≤–µ—Ä—Ö-—Ü–µ–Ω—Ç—Ä
    { x: tableWidth / 2, y: tableHeight, r: 20 } // –Ω–∏–∑-—Ü–µ–Ω—Ç—Ä
  ];

  // ------ –®–∞—Ä—ã ------
  let balls = [];

  function createBall(x, y, color, isCue = false) {
    return {
      x, y,
      vx: 0, vy: 0,
      radius: ballRadius,
      color,
      isCue,
      active: true
    };
  }

  function initBalls() {
    balls = [];
    balls.push(createBall(150, tableHeight / 2, '#ffffff', true));

    const startX = 450;
    const startY = tableHeight / 2;
    const dx = ballRadius * 2.1;
    const dy = ballRadius * 1.8;
    const colors = ['#ff0000', '#0000ff', '#ffff00', '#00ff00', '#ff00ff'];
    let idx = 0;

    for (let row = 0; row < 3; row++) {
      for (let col = 0; col <= row; col++) {
        if (idx < colors.length) {
          const x = startX + row * dx;
          const y = startY - (row * dy) / 2 + col * dy;
          balls.push(createBall(x, y, colors[idx]));
          idx++;
        }
      }
    }
  }

  // ------ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–¥–∞—Ä–æ–º ------
  let isAiming = false;
  let aimStart = { x: 0, y: 0 }; // —Ü–µ–Ω—Ç—Ä –±–∏—Ç–∫–∞
  let aimVector = { x: 0, y: 0 }; // –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–¥–∞—Ä–∞

  canvas.addEventListener('mousedown', (e) => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    const cueBall = balls.find(b => b.isCue && b.active);
    if (!cueBall) return;

    const dx = mx - cueBall.x;
    const dy = my - cueBall.y;
    if (Math.sqrt(dx * dx + dy * dy) <= cueBall.radius) {
      isAiming = true;
      aimStart.x = cueBall.x;
      aimStart.y = cueBall.y;
      aimVector.x = 0;
      aimVector.y = 0;
    }
  });

  canvas.addEventListener('mousemove', (e) => {
    if (!isAiming) return;
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    // –í–µ–∫—Ç–æ—Ä –æ—Ç –±–∏—Ç–∫–∞ –∫ –º—ã—à–∏ ‚Äî —ç—Ç–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–¥–∞—Ä–∞
    aimVector.x = mx - aimStart.x;
    aimVector.y = my - aimStart.y;

    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É (–º–∞–∫—Å. —Å–∏–ª–∞)
    const maxLen = 100;
    const len = Math.sqrt(aimVector.x ** 2 + aimVector.y ** 2);
    if (len > maxLen) {
      aimVector.x = (aimVector.x / len) * maxLen;
      aimVector.y = (aimVector.y / len) * maxLen;
    }
  });

  canvas.addEventListener('mouseup', () => {
    if (isAiming) {
      const cueBall = balls.find(b => b.isCue);
      if (cueBall) {
        const power = 0.12;
        cueBall.vx = aimVector.x * power;
        cueBall.vy = aimVector.y * power;
      }
      isAiming = false;
    }
  });

  // ------ –õ–æ–≥–∏–∫–∞ –ª—É–∑ ------
  function checkPockets() {
    for (let ball of balls) {
      if (!ball.active) continue;
      for (let pocket of pockets) {
        const dx = ball.x - pocket.x;
        const dy = ball.y - pocket.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < pocket.r - ball.radius) {
          ball.active = false; // —à–∞—Ä "–ø—Ä–æ–≤–∞–ª–∏–ª—Å—è"
        }
      }
    }
  }

  // ------ –§–∏–∑–∏–∫–∞ ------
  function distance(a, b) {
    const dx = a.x - b.x;
    const dy = a.y - b.y;
    return Math.sqrt(dx * dx + dy * dy);
  }

  function resolveCollision(a, b) {
    const dx = b.x - a.x;
    const dy = b.y - a.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist === 0) return;

    const nx = dx / dist;
    const ny = dy / dist;

    const overlap = a.radius + b.radius - dist;
    a.x -= nx * overlap * 0.5;
    a.y -= ny * overlap * 0.5;
    b.x += nx * overlap * 0.5;
    b.y += ny * overlap * 0.5;

    const rvx = b.vx - a.vx;
    const rvy = b.vy - a.vy;
    const velAlongNormal = rvx * nx + rvy * ny;

    if (velAlongNormal > 0) return;

    const restitution = 0.95;
    const impulse = -(1 + restitution) * velAlongNormal;
    const impulsePerMass = impulse / 2;

    a.vx -= impulsePerMass * nx;
    a.vy -= impulsePerMass * ny;
    b.vx += impulsePerMass * nx;
    b.vy += impulsePerMass * ny;
  }

  function updateBalls() {
    for (let ball of balls) {
      if (!ball.active) continue;

      ball.x += ball.vx;
      ball.y += ball.vy;

      ball.vx *= friction;
      ball.vy *= friction;

      if (Math.abs(ball.vx) < 0.03 && Math.abs(ball.vy) < 0.03) {
        ball.vx = 0;
        ball.vy = 0;
      }

      // –û—Ç—Å–∫–æ–∫ –æ—Ç –±–æ—Ä—Ç–æ–≤
      if (ball.x - ball.radius < 0) {
        ball.x = ball.radius;
        ball.vx = -ball.vx * 0.9;
      } else if (ball.x + ball.radius > tableWidth) {
        ball.x = tableWidth - ball.radius;
        ball.vx = -ball.vx * 0.9;
      }

      if (ball.y - ball.radius < 0) {
        ball.y = ball.radius;
        ball.vy = -ball.vy * 0.9;
      } else if (ball.y + ball.radius > tableHeight) {
        ball.y = tableHeight - ball.radius;
        ball.vy = -ball.vy * 0.9;
      }
    }

    for (let i = 0; i < balls.length; i++) {
      for (let j = i + 1; j < balls.length; j++) {
        if (balls[i].active && balls[j].active) {
          if (distance(balls[i], balls[j]) < balls[i].radius + balls[j].radius) {
            resolveCollision(balls[i], balls[j]);
          }
        }
      }
    }

    checkPockets();
  }

  // ------ –†–µ–Ω–¥–µ—Ä ------
  function draw() {
    ctx.clearRect(0, 0, tableWidth, tableHeight);

    // –ë–æ—Ä—Ç–∞
    ctx.strokeStyle = '#8b4513';
    ctx.lineWidth = 6;
    ctx.strokeRect(0, 0, tableWidth, tableHeight);

    // –õ—É–∑—ã
    ctx.fillStyle = '#000000';
    for (let p of pockets) {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fill();
    }

    // –°—Ç—Ä–µ–ª–∫–∞ —É–¥–∞—Ä–∞ (–µ—Å–ª–∏ —Ü–µ–ª–∏—Ç–µ—Å—å)
    if (isAiming) {
      const arrowX = aimStart.x + aimVector.x;
      const arrowY = aimStart.y + aimVector.y;

      // –õ–∏–Ω–∏—è
      ctx.beginPath();
      ctx.moveTo(aimStart.x, aimStart.y);
      ctx.lineTo(arrowX, arrowY);
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
      ctx.lineWidth = 2;
      ctx.stroke();

      // –ù–∞–∫–æ–Ω–µ—á–Ω–∏–∫ (—Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –≤–ø–µ—Ä—ë–¥)
      const angle = Math.atan2(aimVector.y, aimVector.x);
      const arrowSize = 12;
      ctx.beginPath();
      ctx.moveTo(arrowX, arrowY);
      ctx.lineTo(
        arrowX - arrowSize * Math.cos(angle - Math.PI / 6),
        arrowY - arrowSize * Math.sin(angle - Math.PI / 6)
      );
      ctx.lineTo(
        arrowX - arrowSize * Math.cos(angle + Math.PI / 6),
        arrowY - arrowSize * Math.sin(angle + Math.PI / 6)
      );
      ctx.closePath();
      ctx.fillStyle = '#ffffff';
      ctx.fill();
    }

    // –®–∞—Ä—ã
    for (let ball of balls) {
      if (!ball.active) continue;

      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = ball.color;
      ctx.fill();
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 1;
      ctx.stroke();

      // –ë–ª–∏–∫
      ctx.beginPath();
      ctx.arc(
        ball.x - ball.radius * 0.3,
        ball.y - ball.radius * 0.3,
        ball.radius * 0.4,
        0,
        Math.PI * 2
      );
      ctx.fillStyle = 'rgba(255,255,255,0.5)';
      ctx.fill();
    }
  }

  // ------ –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª ------
  function gameLoop() {
    updateBalls();
    draw();
    requestAnimationFrame(gameLoop);
  }

  function resetGame() {
    initBalls();
  }

  initBalls();
  gameLoop();
</script>

</body>
</html>
